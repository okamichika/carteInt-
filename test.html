<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8"/>
    <meta http-equiv="X-UA-Compatible" content="IE=edge"/>
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    <title>Musée</title>
    <link rel="Icon" href="#"/>
    <link rel="stylesheet" href="./Src/style.css"/>
    <link rel="stylesheet" href="./Src/sidebare.css"/>
    <script src="https://unpkg.com/@phosphor-icons/web"></script>
    <link
            rel="stylesheet"
            href="https://unpkg.com/leaflet@1.7.1/dist/leaflet.css"
            integrity="sha512-xodZBNTC5n17Xt2atTPuE1HxjVMSvLVW9ocqUKLsCC5CXdbqCmblAshOMAS6/keqq/sMZMZ19scR4PsZChSR7A=="
            crossorigin=""
    />
    <title>Document</title>
</head>
<body>
<div class="sidebar">
    <div class="menu-btn">
        <i class="ph-bold ph-caret-left"></i>
    </div>
    <div class="head">
        <div class="user-img">
            <img src="user.jpg" alt=""/>
        </div>
        <div class="user-details">
            <p class="title">web developer</p>
            <p class="name">John Doe</p>
        </div>
    </div>
    <div class="nav">
        <div class="menu">
            <p class="title">Main</p>
            <ul>
                <li>
                    <a href="#">
                        <i class="icon ph-bold ph-house-simple"></i>
                        <span class="text">Dashboard</span>
                    </a>
                </li>
                <li>
                    <a href="#">
                        <i class="icon ph-bold ph-user"></i>
                        <span class="text">Audience</span>
                        <i class="arrow ph-bold ph-caret-down"></i>
                    </a>
                    <ul class="sub-menu">
                        <li>
                            <a href="#">
                                <span class="text">Users</span>
                            </a>
                        </li>
                        <li>
                            <a href="#">
                                <span class="text">Subscribers</span>
                            </a>
                        </li>
                    </ul>
                </li>
                <li>
                    <a href="#">
                        <i class="icon ph-bold ph-user"></i>
                        <span class="text">Filtre</span>
                        <i class="arrow ph-bold ph-caret-down"></i>
                    </a>
                    <ul class="sub-menu">
                        <li>
                            <a href="#">
                                <i class="icon ph-bold ph-user"></i>
                                <span class="text">Note</span>
                                <i class="arrow ph-bold ph-caret-down"></i>
                            </a>
                            <ul class="sub-menu">
                                <li>
                                    <a href="#">
                                        <a href="#">
                                            <div>
                                                <label><input type="checkbox" value="1" class="filter-checkbox"> Note 1</label>
                                            </div>

                                        </a>
                                    </a>
                                </li>
                                <li>
                                    <a href="#">
                                        <a href="#">
                                            <div>
                                                <label><input type="checkbox" value="2" class="filter-checkbox"> Note 2</label>
                                            </div>

                                        </a>
                                    </a>
                                </li>
                                <li>
                                    <a href="#">
                                        <a href="#">
                                            <div>
                                                <label><input type="checkbox" value="3" class="filter-checkbox"> Note 3</label>
                                            </div>

                                        </a>
                                    </a>
                                </li>
                                <li>
                                    <a href="#">
                                        <a href="#">
                                            <div>
                                                <label><input type="checkbox" value="4" class="filter-checkbox"> Note 4</label>
                                            </div>

                                        </a>
                                    </a>
                                </li>
                                <li>
                                    <a href="#">
                                        <a href="#">
                                            <div>
                                                <label><input type="checkbox" value="5" class="filter-checkbox"> Note 5</label>
                                            </div>

                                        </a>
                                    </a>
                                </li>
                            </ul>
                        </li>
                    </ul>
                </li>
                <li class="active">
                    <a href="#">
                        <i class="icon ph-bold ph-file-text"></i>
                        <span class="text">Posts</span>
                    </a>
                </li>
                <li>
                    <a href="#">
                        <i class="icon ph-bold ph-calendar-blank"></i>
                        <span class="text">Schedules</span>
                    </a>
                </li>
                <li>
                    <a href="#">
                        <i class="icon ph-bold ph-chart-bar"></i>
                        <span class="text">Income</span>
                        <i class="arrow ph-bold ph-caret-down"></i>
                    </a>
                    <ul class="sub-menu">
                        <li>
                            <a href="#">
                                <span class="text">Earnings</span>
                            </a>
                        </li>
                        <li>
                            <a href="#">
                                <span class="text">Funds</span>
                            </a>
                        </li>
                        <li>
                            <a href="#">
                                <span class="text">Declines</span>
                            </a>
                        </li>
                        <li>
                            <a href="#">
                                <span class="text">Payouts</span>
                            </a>
                        </li>
                    </ul>
                </li>
            </ul>
        </div>
        <div class="menu">
            <p class="title">Settings</p>
            <ul>
                <li>
                    <a href="#">
                        <i class="icon ph-bold ph-gear"></i>
                        <span class="text">Settings</span>
                    </a>
                </li>
            </ul>
        </div>
    </div>
    <div class="menu">
        <p class="title">Account</p>
        <ul>
            <li>
                <a href="#">
                    <i class="icon ph-bold ph-info"></i>
                    <span class="text">Help</span>
                </a>
            </li>
            <li>
                <a href="#">
                    <i class="icon ph-bold ph-sign-out"></i>
                    <span class="text">Logout</span>
                </a>
            </li>
        </ul>
    </div>
</div>
<div id="map">
</div>

<!-- Jquery -->
<script
        src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.7.0/jquery.js"
        integrity="sha512-8Z5++K1rB3U+USaLKG6oO8uWWBhdYsM3hmdirnOEWp8h2B1aOikj5zBzlXs8QOrvY9OxEnD2QDkbSKKpfqcIWw=="
        crossorigin="anonymous"
></script>

<script
        type="module"
        src="https://unpkg.com/ionicons@5.5.2/dist/ionicons/ionicons.esm.js"
></script>
<script
        nomodule
        src="https://unpkg.com/ionicons@5.5.2/dist/ionicons/ionicons.js"
></script>
<script
        src="https://unpkg.com/leaflet@1.7.1/dist/leaflet.js"
        integrity="sha512-XQoYMqMTK8LvdxXYG3nZ448hOEQiglfqkJs1NOQV44cWnUrBc8PkAOcXy20w0vlaXaVUearIOBhiXZ5V3ynxwA=="
        crossorigin=""
></script>
<script src="./Src/app.js"></script>
<script src="./Src/data.js"></script>
<script src="https://unpkg.com/leaflet.markercluster/dist/leaflet.markercluster.js"></script>
<link rel="stylesheet" href="https://unpkg.com/leaflet.markercluster/dist/MarkerCluster.css"/>
<link rel="stylesheet" href="https://unpkg.com/leaflet.markercluster/dist/MarkerCluster.Default.css"/>
<!--<script>


    var map = L.map('map').setView([48.853, 2.35], 10);

    var Stadia_OSMBright = L.tileLayer(
        "https://tiles.stadiamaps.com/tiles/osm_bright/{z}/{x}/{y}{r}.png",
        {
            maxZoom: 13,
            minZoom: 3,
            bounds: [[-90, -180], [90, 180]],
            attribution: '&copy; <a href="https://stadiamaps.com/">Stadia Maps</a>, &copy; <a href="https://openmaptiles.org/">OpenMapTiles</a> &copy; <a href="http://openstreetmap.org">OpenStreetMap</a> contributors',
        }
    );

    Stadia_OSMBright.addTo(map);

    function updateMarkers() {
        var currentZoom = map.getZoom();
        // Créez un groupe de clusters
        var markers = L.markerClusterGroup();

        // Clear existing markers
        map.eachLayer(function (layer) {
            if (layer instanceof L.Marker) {
                map.removeLayer(layer);
            }
        });

        // Loop through the data and add markers based on the zoom level
        data.forEach(function (item) {
            var coordinates = item.fields.geolocalisation;
            var popupContent = "Nom du musée : " + item.fields.nom_officiel_du_musee + "<br/>Note : " + item.fields.note;
            var marker = L.marker(coordinates).bindPopup(popupContent);
            markers.addLayer(marker);  // Ajoutez le marqueur au groupe de clusters
            marker.on('click', function () {
                marker.openPopup();
            });
        });

        // Ajoutez le groupe de clusters à la carte
        map.addLayer(markers);
    }

    map.on('zoomend', updateMarkers);

    // Appel initial pour afficher les marqueurs au démarrage
    updateMarkers();



</script>-->
<script>
    var map = L.map('map').setView([48.853, 2.35], 10);

    var Stadia_OSMBright = L.tileLayer(
        "https://tiles.stadiamaps.com/tiles/osm_bright/{z}/{x}/{y}{r}.png",
        {
            maxZoom: 13,
            minZoom: 3,
            bounds: [[-90, -180], [90, 180]],
            attribution: '&copy; <a href="https://stadiamaps.com/">Stadia Maps</a>, &copy; <a href="https://openmaptiles.org/">OpenMapTiles</a> &copy; <a href="http://openstreetmap.org">OpenStreetMap</a> contributors',
        }
    );

    Stadia_OSMBright.addTo(map);

    // Your existing data


    var markers = L.markerClusterGroup(); // Create a marker cluster group

    function updateMarkers(filteredData) {
        markers.clearLayers(); // Clear existing markers

        filteredData.forEach(function (item) {
            var coordinates = item.fields.geolocalisation;
            var popupContent = "Nom du musée : " + item.fields.nom_officiel_du_musee + "<br/>Note : " + item.fields.note;
            var marker = L.marker(coordinates).bindPopup(popupContent);
            markers.addLayer(marker); // Add marker to the cluster group
            marker.on('click', function () {
                marker.openPopup();
            });
        });

        map.addLayer(markers); // Add the marker cluster group to the map
    }
    function updateData() {
        var selectedNotes = Array.from(document.querySelectorAll('.filter-checkbox:checked')).map(function (checkbox) {
            return parseInt(checkbox.value);
        });

        var filteredData = data.filter(function (item) {
            return selectedNotes.includes(Math.floor(item.fields.note));
        });

        // Display or use the filteredData as needed
        console.log(filteredData);

        // Update the markers on the map
        updateMarkers(filteredData);
    }

    // Attach event listener to checkboxes
    var checkboxes = document.querySelectorAll('.filter-checkbox');
    checkboxes.forEach(function (checkbox) {
        checkbox.addEventListener('change', updateData);
    });

    // Initial call to display markers on startup
    updateMarkers(data);
</script>

</body>
</html>
